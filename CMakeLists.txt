cmake_minimum_required(VERSION 3.7)
project(XamlCpp CXX)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/cmake/Modules")

set(BUILD_WINDOWS OFF CACHE BOOL "Build for Windows with Windows API")
set(BUILD_COCOA OFF CACHE BOOL "Build for Mac with Cocoa")
set(BUILD_GTK3 OFF CACHE BOOL "Build with GTK3")

if(NOT ${BUILD_WINDOWS} AND NOT ${BUILD_COCOA} AND NOT ${BUILD_GTK3})
    if(WIN32)
        set(BUILD_WINDOWS ON)
    elseif(UNIX)
        if(APPLE)
            set(BUILD_COCOA ON)
        else()
            set(BUILD_GTK3 ON)
        endif()
    endif()
endif()

set(XAML_BUILD_DEFINITIONS "")
set(XAML_COMPILE_OPTIONS "")

if(${BUILD_WINDOWS})
    set(XAML_BUILD_DEFINITIONS "-DUNICODE -D_UNICODE -DXAML_UI_WINDOWS -DVC_EXTRALEAN")
    set(XAML_COMPILE_OPTIONS "")
elseif(${BUILD_COCOA})
    set(XAML_BUILD_DEFINITIONS "-DXAML_UI_COCOA")
    set(XAML_COMPILE_OPTIONS "-fobjc-arc")
elseif(${BUILD_GTK3})
    set(XAML_BUILD_DEFINITIONS "-DXAML_UI_GTK3")
    set(XAML_COMPILE_OPTIONS "")
endif()

add_definitions(${XAML_BUILD_DEFINITIONS})
add_compile_options(${XAML_COMPILE_OPTIONS})

add_subdirectory(meta)

set(XAML_PRIVATE_INCLUDE_DIRS )

if(${BUILD_WINDOWS})
    find_package(WIL REQUIRED)
    set(XAML_PRIVATE_INCLUDE_DIRS ${WIL_INCLUDE_DIRS})
elseif(${BUILD_GTK3})
    find_package(GTK3 REQUIRED)
    set(XAML_PRIVATE_INCLUDE_DIRS ${GTK3_INCLUDE_DIRS})
endif()

add_subdirectory(ui)
add_subdirectory(xaml)
add_subdirectory(xamlc)
